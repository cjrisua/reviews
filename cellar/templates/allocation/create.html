{% extends "cellar/base.html" %}
{% load crispy_forms_tags %}
{% load cellar_tags %}
{%block content %}
    <form action="" method="post">
        {% csrf_token %}
        <div class="row no-gutters">
            <div class="col-10">
              {{form.producer_name|as_crispy_field}}
                {{form.producer|as_crispy_field}}
            </div>
            <div class="col-2">
                <div class="pl-0 mt-3">
                    <button type="button" class="btn btn-dark subregion-filter" data-toggle="modal" data-target="#producerModal" data-whatever="@mdo">
                        <i class="fas fa-user-plus" style="color:#f5f7f4;"></i>
                    </button>
                </div>
            </div>
        </div>
        
        {{form.signupdate|as_crispy_field}}
        {{form.status|as_crispy_field}}
        {{form.addeddate|as_crispy_field}}
        {{form.mailingmonths|as_crispy_field}}
        {{form.lastpurchasedate|as_crispy_field}}
        {{form.inactivitypenalty|as_crispy_field}}
        <button type="submit" class="btn">Save</button>
    </form>
    <div class="modal fade" id="producerModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalLabel">Add Producer</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              {% include "allocation/producer-create.html" with form=producerform %}
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
              <button id="submitProducer" type="button" class="btn btn-dark">Add</button>
            </div>
          </div>
        </div>
      </div>
{% endblock %}
{% block javascript %}
<script>
    $(document).ready(function(){
      
      function AllocationAdvanceOptions(status)
      {
        $("#div_id_addeddate").toggle(status);
        $("#div_id_mailingmonths").toggle(status);
        $("#div_id_inactivitypenalty").toggle(status);
        $("#div_id_lastpurchasedate").toggle(status);
      }

      if ($("#id_status option:selected").text() != "Active")
        AllocationAdvanceOptions(false)

      {% autoescape off %}
      var availableTags = {% producer_dict %}
      {% endautoescape %}

      /*var availableTags = []
      var data = producersList.forEach((element) => {
        availableTags.push(element['name'])
      });*/

      $(document).on("change", "#id_status", function(event){
        if($("#id_status option:selected").text() == "Active")
          AllocationAdvanceOptions(true)
        else
          AllocationAdvanceOptions(false)
      });

      $( "#id_producer_name" ).autocomplete({
        source: availableTags,
        select: function (event, ui) {
          //$("#id_producer").removeData()
          //$("#id_producer").val(ui.item.key)
          $("#id_producer").attr('value', ui.item.key)
          //$("#id_producer").val(ui.item.value)
          console.log($("#id_producer"))
        }
      });

      $(document).on( 'click', '#submitProducer', function(event){
        $('#producerForm').submit();
      });


    });
</script>
{% endblock %}